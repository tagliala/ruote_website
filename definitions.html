<!DOCTYPE html>
<html><head>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<title>ruote - process definitions</title>
<script src='/ruote_website/js/shCore.js'></script>
<script src='/ruote_website/js/shBrushXml.js'></script>
<script src='/ruote_website/js/shBrushBash.js'></script>
<script src='/ruote_website/js/shBrushRuby.js'></script>
<script src='/ruote_website/js/shBrushJScript.js'></script>
<!-- %script{ :src => "/js/jquery-1.6.1.min.js" } -->
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js'></script>
<link href='/ruote_website/css/reset.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shCore.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shThemeRuote.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/ruote.css' rel='stylesheet' type='text/css'>
</head><body>
<div id='container'>
<div id='header'>
<div id='header-center'>
<div id='header-left'>
<a href='/ruote_website'>
<img src='/ruote_website/images/ruote.png'>
</a>
<div id='header-subtitle'>
a ruby workflow engine
</div>
</div>
<div id='header-right'>
<div id='nav'>
<span>
<a href='/ruote_website/documentation.html' title='documentation'>
doc
</a>
<a href='/ruote_website/source.html' title='source code'>
source
</a>
<a href='/ruote_website/download.html' title='download'>
download
</a>
<a class='nihongo' href='/ja.html' title='日本語'>
日本語
</a>
</span>
</div>
</div>
</div>
</div>
<div id='content'>
<div id='content-center'>
<div id='sidebar'><h3 onclick='document.location = &quot;/ruote_website/documentation.html&quot;' style='cursor: pointer'>
Documentation
</h3>
<ul>
<li>
<a href='/ruote_website/common_attributes.html'>
common attributes
</a>
</li>
<li>
<a href='/ruote_website/conditions.html'>
conditions
</a>
</li>
<li>
<a href='/ruote_website/configuration.html'>
configuration
</a>
</li>
<li>
<a href='/ruote_website/documentation.html'>
documentation
</a>
</li>
<li>
<a href='/ruote_website/dollar.html'>
dollar notation
</a>
</li>
<li>
<a href='/ruote_website/download.html'>
download
</a>
</li>
<li>
<a href='/ruote_website/expressions.html'>
expressions
</a>
</li>
<li>
<a href='/ruote_website/glossary.html'>
glossary
</a>
</li>
<li>
<a href='/ruote_website/implementing_a_storage.html'>
implementing a storage
</a>
</li>
<li>
<a href='/ruote_website/implementing_participants.html'>
implementing participants
</a>
</li>
<li>
<a href='/ruote_website/lists.html'>
lists
</a>
</li>
<li>
<a href='/ruote_website/noisy.html'>
noisy output
</a>
</li>
<li>
<a href='/ruote_website/part_implementations.html'>
participant implementations
</a>
</li>
<li>
<a href='/ruote_website/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/ruote_website/process_administration.html'>
process administration
</a>
</li>
<li class='current'>
<a href='/ruote_website/definitions.html'>
process definitions
</a>
</li>
<li>
<a href='/ruote_website/process_observation.html'>
process observation
</a>
</li>
<li>
<a href='/ruote_website/participants.html'>
process participants
</a>
</li>
<li>
<a href='/ruote_website/rel.html'>
rel values for ruote-http / ruote-kit links
</a>
</li>
<li>
<a href='/ruote_website/resources.html'>
resources
</a>
</li>
<li>
<a href='/ruote_website/users.html'>
ruote users
</a>
</li>
<li>
<a href='/ruote_website/sample_workflow_run.html'>
sample workflow run
</a>
</li>
<li>
<a href='/ruote_website/source.html'>
source
</a>
</li>
<li>
<a href='/ruote_website/testing_participants.html'>
testing participants
</a>
</li>
<li>
<a href='/ruote_website/testing_processes.html'>
testing processes
</a>
</li>
<li>
<a href='/ruote_website/vars_and_fields.html'>
variables and fields
</a>
</li>
<li>
<a href='/ruote_website/with_rails.html'>
with rails
</a>
</li>
<li>
<a href='/ruote_website/patterns.html'>
workflow control patterns
</a>
</li>
<li>
<a href='/ruote_website/ja.html'>
日本語
</a>
</li>
</ul>
<h3>
More
</h3>
<ul class='contact'>
<li>
<a href='https://github.com/jmettraux/ruote/tree/master/quickstart'>
quickstart
</a>
</li>
<li>
<a href='/ruote_website/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/ruote_website/resources.html'>
resources
</a>
</li>
<li>
<a href='/ruote_website/users.html'>
users
</a>
</li>
</ul>
<h3>
Meta
</h3>
<ul class='contact'>
<li>
<a href='/ruote_website/source.html'>
source
</a>
</li>
<li>
<a href='/ruote_website/download.html'>
download
</a>
</li>
<li>
<a href='http://jmettraux.github.com'>
blog
</a>
</li>
<li>
<a href='/ruote_website/lists.html'>
mailing list
</a>
</li>
<li>
<a href='http://ruote-ci.s3.amazonaws.com/ci.html'>
continuous integration
</a>
</li>
<li>
<a href='http://ruote-irclogs.s3.amazonaws.com/logs.html'>
IRC
</a>
</li>
<li>
<a href='https://www.ohloh.net/p/ruote/'>
on ohloh
</a>
</li>
</ul>
<h3>
<span>
Search
</span>
</h3>
<ul class='contact'>
<li>
<form action='http://www.google.com/search' method='GET'>
<input id='qq' name='qq' style='' type='text'>
<input id='q' name='q' type='hidden'>
<input onclick='adjustSearch();' type='submit' value='search'>
</form>
</li>
</ul>
<script>
  function adjustSearch() {
    $('#q').val($('#qq').val() + ' site:http://ruote.rubyforge.org');
  }
</script>
</div>
<div id='content-main'>
<h2>process definitions</h2>
<p>Process definitions are documents that describe how a [business] process should orchestrate the flow of work among participants.</p>
<p>Participants are registered at start time usually. While process definitions are &#8216;parsed&#8217; at their launch time. Each launch of a process definition creates a process instance.</p>
<p>Ruote turns process definitions into an abstract syntax tree (a &#8216;tree&#8217; for short) at launch time. This tree gets interpreted during the workflow execution.</p>
<p>Process definitions in four &#8220;languages&#8221; are understood:</p>
<ul>
	<li><a href="#ruby">Ruby <span class="caps">DSL</span></a></li>
	<li><a href="#xml"><span class="caps">XML</span> process definitions</a></li>
	<li><a href="#radial">Radial process definitions</a></li>
	<li><a href="#tree">Plain trees</a> (as <span class="caps">JSON</span>)</li>
</ul>
<p>There is an interesting complementary technique, workflow <a href="#generation">generation</a>.</p>
<p>A process definition contains 1 main process definition and may contain 1 or more sub-process definitions. For example:</p>
<pre class="brush: ruby">
  Ruote.define 'test' do

    subprocess :ref =&gt; 'analysis'
    subprocess :ref =&gt; 'publication'

    define 'analysis' do
      participant :ref =&gt; 'alice'
      participant :ref =&gt; 'bob'
    end
    define 'publication' do
      participant :ref =&gt; 'charly'
    end
  end
</pre>
<h3 id="ruby">Ruby process definitions</h3>
<p>Some kind of Ruby <span class="caps">DSL</span> can be used to define processes :</p>
<pre class="brush: ruby">
  Ruote.define 'my_def' do
    participant :ref =&gt; 'alice'
    participant :ref =&gt; 'bob'
  end
</pre>
<p>One advantage of this &#8216;notation&#8217; is that passing complex data structures from the process definition is possible :</p>
<pre class="brush: ruby">
  Ruote.define 'my_def' do
    set :field =&gt; 'items', :value =&gt; { 'cars' =&gt; 2, 'trucks' =&gt; 0 }
    participant :ref =&gt; 'alice'
    participant :ref =&gt; 'bravo'
  end
</pre>
<p>Not necessarily a good practice but can come in handy, and remember that ruote will flatten that to something that is JSONifiable.</p>
<p>One interesting twist of Ruby process definitions: they are Ruby, so it&#8217;s code executed (at definition time). A process like:</p>
<pre class="brush: ruby">
  Ruote.define 'my_def' do
    cursor do
      alice
      bob
      charly
      doug
    end
  end
</pre>
<p>can be simplified to:</p>
<pre class="brush: ruby">
  Ruote.define 'my_def' do
    cursor do
      %w[ alice bob charly doug ].collect { |name| __send__(name) }
    end
  end
</pre>
<p>&#8230;</p>
<h3 id="radial">Radial process definitions</h3>
<p>Radial is a mini-language introduced with ruote 2.3.0. It looks like a cross of Python and <span class="caps">JSON</span>, but is very similar to definitions expressed in the usual Ruby <span class="caps">DSL</span> (without the definition time execution).</p>
<p>The above process definition in Ruby would like this in radial:</p>
<pre class="brush: ruby">
  define my_def
    set field: items, value: { cars: 2, trucks: 0 }
    participant ref: alice
    participant ref: bravo
</pre>
<p>Radial is very accomodating, no need to enclose one word strings in quotes for examples. Indentation matters though (a bit like in Python).</p>
<p>No possibility for running Ruby code at definition, but a lighter weight syntax.</p>
<p>Quotes are OK (and they are necessaring for more than word strings or forcing numbers to strings:</p>
<pre class="brush: ruby">
  define my_def
    set field: items, value: { cars: '2', trucks: 0 }
    participant ref: "alice azer"
    participant ref: "bob bitume", "next mission": "conquer the moon"
</pre>
<h3 id="xml"><span class="caps">XML</span> process definitions</h3>
<p><span class="caps">XML</span> may be advantageous for some people as it looks enterprisey. Perhaps a better reason for using it is the fact that libraries for generating <span class="caps">XML</span> documents abound, as well as other <span class="caps">XML</span> related tools.</p>
<pre class="brush: xml">
  &lt;process-definition name="my_def"&gt;
    &lt;participant ref="alice" /&gt;
    &lt;participant ref="bob" /&gt;
  &lt;/process-definition&gt;
</pre>
<p>You can use the parser to turn <span class="caps">XML</span> into a Ruote tree :</p>
<pre class="brush: ruby">
require 'ruote/reader'

tree = Ruote::Reader.read(%{
  &lt;process-definition name="my_def"&gt;
    &lt;participant ref="alice" /&gt;
    &lt;participant ref="bob" /&gt;
  &lt;/process-definition&gt;
})

p tree
  # =&gt;
  # ["process_definition", {"name"=&gt;"my_def"}, [
  #   ["participant", {"ref"=&gt;"alice"}, []],
  #   ["participant", {"ref"=&gt;"bob"}, []]]]]]
</pre>
<p>Or directly pass the <span class="caps">XML</span> as a String to the engine :</p>
<pre class="brush: ruby">
engine.launch(%{
  &lt;process-definition name="my_def"&gt;
    &lt;sequence&gt;
      &lt;participant ref="alice" /&gt;
      &lt;participant ref="bob" /&gt;
    &lt;/sequence&gt;
  &lt;/process-definition&gt;
})
</pre>
<h3 id="tree">raw [<span class="caps">JSON</span>] process definitions</h3>
<p>In <span class="caps">JSON</span>, they would look like :</p>
<pre class="brush: jscript">
  [ 'process-definition', { 'name': 'my_def' }, [
    [ 'participant', { 'ref': 'alice' }, [] ],
    [ 'participant', { 'ref': 'bob' }, [] ]
  ] ]
</pre>
<p>In Ruby, that translates to :</p>
<pre class="brush: ruby">
  [ 'process-definition', { 'name' =&gt; 'my_def' }, [
    [ 'participant', { 'ref' =&gt; 'alice' }, [] ],
    [ 'participant', { 'ref' =&gt; 'bob' }, [] ]
  ] ]
</pre>
<p>The engine understands various formats :</p>
<pre class="brush: ruby">
  engine.launch('[ "participant", { "ref" : "alpha" }, [] ]')
    # JSON string

  engine.launch(Rufus::Json.decode('[ "participant", { "ref" : "alpha" }, [] ]'))
    # decoded JSON

  engine.launch([ "participant", { "ref" =&gt; "alpha" }, [] ])
    # Ruby raw process definition
</pre>
<p>This raw representation of a process definition can also accomodate deep data structures like the Ruby <span class="caps">DSL</span> does.</p>
<h3 id="generation">process definition generation</h3>
<p>So we&#8217;ve seen nice &#8220;ruby process definition&#8221;, but shouldn&#8217;t we rather say &#8220;process definition generation via ruby&#8221; ?</p>
<pre class="brush: ruby">
require 'ruote'

pdef = Ruote.process_definition do
  sequence do
    alpha
    bravo
  end
end

p pdef
  # =&gt;
  # ["define", {}, [
  #   ["sequence", {}, [["alpha", {}, []], ["bravo", {}, []]]]]]
</pre>
<p>The class method &#8220;process_definition&#8221; is used to generate a process definiton (a tree of expressions).</p>
<p>Maybe this piece of Ruby code makes the &#8220;generation&#8221; aspect more visible :</p>
<pre class="brush: ruby">
pdef = Ruote.process_definition do
  %w[ alpha bravo charly doug ].each do |pa|
    participant :ref =&gt; pa
  end
end

p pdef
  # =&gt;
  # ["define", {}, [
  #   ["participant", {"ref"=&gt;"alpha"}, []],
  #   ["participant", {"ref"=&gt;"bravo"}, []],
  #   ["participant", {"ref"=&gt;"charly"}, []],
  #   ["participant", {"ref"=&gt;"doug"}, []]]]
</pre>
<h3>see also</h3>
<ul>
	<li><a href="process_testing.html">process testing</a> &#8211; testing process definitions</li>
</ul>
</div>
</div>
</div>
</div>
<div id='footer'>
<div id='footer-center'>
<p>
<span id='footer-left'>
<a href='https://github.com/jmettraux/ruote_website/issues'>doc issue reporting</a>
|
<a href='https://github.com/jmettraux/ruote_website'>doc source</a>
| created with
<a href='http://nanoc.stoneship.org'>nanoc</a>
and
<a href='http://alexgorbatchev.com/SyntaxHighlighter/'>syntax highlighter</a>
</span>
<span id='footer-right'>
&copy; 2005-2013 the ruote team
</span>
</p>
</div>
</div>
<script>
  SyntaxHighlighter.all();
</script>
</body>
</html>
