<!DOCTYPE html>
<html><head>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<title>ruote - configuration</title>
<script src='/ruote_website/js/shCore.js'></script>
<script src='/ruote_website/js/shBrushXml.js'></script>
<script src='/ruote_website/js/shBrushBash.js'></script>
<script src='/ruote_website/js/shBrushRuby.js'></script>
<script src='/ruote_website/js/shBrushJScript.js'></script>
<!-- %script{ :src => "/js/jquery-1.6.1.min.js" } -->
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js'></script>
<link href='/ruote_website/css/reset.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shCore.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shThemeRuote.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/ruote.css' rel='stylesheet' type='text/css'>
</head><body>
<div id='container'>
<div id='header'>
<div id='header-center'>
<div id='header-left'>
<a href='/ruote_website'>
<img src='/ruote_website/images/ruote.png'>
</a>
<div id='header-subtitle'>
a ruby workflow engine
</div>
</div>
<div id='header-right'>
<div id='nav'>
<span>
<a href='/ruote_website/documentation.html' title='documentation'>
doc
</a>
<a href='/ruote_website/source.html' title='source code'>
source
</a>
<a href='/ruote_website/download.html' title='download'>
download
</a>
<a class='nihongo' href='/ja.html' title='日本語'>
日本語
</a>
</span>
</div>
</div>
</div>
</div>
<div id='content'>
<div id='content-center'>
<div id='sidebar'><h3 onclick='document.location = &quot;/documentation.html&quot;' style='cursor: pointer'>
Documentation
</h3>
<ul>
<li>
<a href='/ruote_website/exp/add_branches.html'>
add_branches expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/add_branches.html'>
add_branches
</a>
</li>
<li>
<a href='/ruote_website/exp/add_branches.html'>
add_branch
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/apply.html'>
apply expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/apply.html'>
apply
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/await.html'>
await expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/await.html'>
await
</a>
</li>
</ul>
<li>
<a href='/ruote_website/part/block_participant.html'>
block_participant
</a>
</li>
<li>
<a href='/ruote_website/exp/cancel_process.html'>
cancel_process expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/cancel_process.html'>
cancel_process
</a>
</li>
<li>
<a href='/ruote_website/exp/cancel_process.html'>
terminate
</a>
</li>
<li>
<a href='/ruote_website/exp/cancel_process.html'>
kill_process
</a>
</li>
</ul>
<li>
<a href='/ruote_website/part/code_participant.html'>
code_participant
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
command expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/command.html'>
skip
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
back
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
jump
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
rewind
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
continue
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
break
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
stop
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
over
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
reset
</a>
</li>
</ul>
<li>
<a href='/ruote_website/common_attributes.html'>
common attributes
</a>
</li>
<li>
<a href='/ruote_website/exp/concurrence.html'>
concurrence expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/concurrence.html'>
concurrence
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/concurrent_iterator.html'>
concurrent_iterator expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/concurrent_iterator.html'>
concurrent_iterator
</a>
</li>
<li>
<a href='/ruote_website/exp/concurrent_iterator.html'>
citerator
</a>
</li>
</ul>
<li>
<a href='/ruote_website/conditions.html'>
conditions
</a>
</li>
<li class='current'>
<a href='/ruote_website/configuration.html'>
configuration
</a>
</li>
<li>
<a href='/ruote_website/exp/cron.html'>
cron expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/cron.html'>
cron
</a>
</li>
<li>
<a href='/ruote_website/exp/cron.html'>
every
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/cursor.html'>
cursor expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/cursor.html'>
cursor
</a>
</li>
<li>
<a href='/ruote_website/exp/cursor.html'>
loop
</a>
</li>
<li>
<a href='/ruote_website/exp/cursor.html'>
repeat
</a>
</li>
</ul>
<li>
<a href='/ruote_website/part/decision_participant.html'>
decision_participant
</a>
</li>
<li>
<a href='/ruote_website/exp/define.html'>
define expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/define.html'>
define
</a>
</li>
<li>
<a href='/ruote_website/exp/define.html'>
process_definition
</a>
</li>
<li>
<a href='/ruote_website/exp/define.html'>
workflow_definition
</a>
</li>
</ul>
<li>
<a href='/ruote_website/documentation.html'>
documentation
</a>
</li>
<li>
<a href='/ruote_website/dollar.html'>
dollar notation
</a>
</li>
<li>
<a href='/ruote_website/download.html'>
download
</a>
</li>
<li>
<a href='/ruote_website/exp/echo.html'>
echo expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/echo.html'>
echo
</a>
</li>
</ul>
<li>
<a href='/ruote_website/part/engine_participant.html'>
engine_participant
</a>
</li>
<li>
<a href='/ruote_website/exp/equals.html'>
equals expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/equals.html'>
equals
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/error.html'>
error expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/error.html'>
error
</a>
</li>
</ul>
<li>
<a href='/ruote_website/expressions.html'>
expressions
</a>
</li>
<li>
<a href='/ruote_website/exp/filter.html'>
filter expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/filter.html'>
filter
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/forget.html'>
forget expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/forget.html'>
forget
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/given.html'>
given expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/given.html'>
given
</a>
</li>
</ul>
<li>
<a href='/ruote_website/glossary.html'>
glossary
</a>
</li>
<li>
<a href='/ruote_website/exp/if.html'>
if expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/if.html'>
if
</a>
</li>
</ul>
<li>
<a href='/ruote_website/implementing_a_storage.html'>
implementing a storage
</a>
</li>
<li>
<a href='/ruote_website/implementing_participants.html'>
implementing participants
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
inc expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/inc.html'>
inc
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
dec
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
increment
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
decrement
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
push
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
pop
</a>
</li>
</ul>
<li>
<a href='/ruote_website.html'>
index
</a>
</li>
<li>
<a href='/ruote_website/exp/iterator.html'>
iterator expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/iterator.html'>
iterator
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/let.html'>
let expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/let.html'>
let
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/listen.html'>
listen expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/listen.html'>
listen
</a>
</li>
<li>
<a href='/ruote_website/exp/listen.html'>
receive
</a>
</li>
<li>
<a href='/ruote_website/exp/listen.html'>
intercept
</a>
</li>
</ul>
<li>
<a href='/ruote_website/lists.html'>
lists
</a>
</li>
<li>
<a href='/ruote_website/part/local_participant.html'>
local_participant
</a>
</li>
<li>
<a href='/ruote_website/exp/lose.html'>
lose expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/lose.html'>
lose
</a>
</li>
</ul>
<li>
<a href='/ruote_website/part/no_op_participant.html'>
no_op_participant
</a>
</li>
<li>
<a href='/ruote_website/noisy.html'>
noisy output
</a>
</li>
<li>
<a href='/ruote_website/exp/noop.html'>
noop expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/noop.html'>
noop
</a>
</li>
</ul>
<li>
<a href='/ruote_website/part/null_participant.html'>
null_participant
</a>
</li>
<li>
<a href='/ruote_website/exp/on_error.html'>
on_error expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/on_error.html'>
on_error
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/once.html'>
once expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/once.html'>
once
</a>
</li>
<li>
<a href='/ruote_website/exp/once.html'>
when
</a>
</li>
<li>
<a href='/ruote_website/exp/once.html'>
as_soon_as
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/participant.html'>
participant expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/participant.html'>
participant
</a>
</li>
</ul>
<li>
<a href='/ruote_website/part_implementations.html'>
participant implementations
</a>
</li>
<li>
<a href='/ruote_website/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/ruote_website/process_administration.html'>
process administration
</a>
</li>
<li>
<a href='/ruote_website/definitions.html'>
process definitions
</a>
</li>
<li>
<a href='/ruote_website/process_observation.html'>
process observation
</a>
</li>
<li>
<a href='/ruote_website/participants.html'>
process participants
</a>
</li>
<li>
<a href='/ruote_website/exp/read.html'>
read expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/read.html'>
read
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/redo.html'>
redo expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/redo.html'>
redo
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/ref.html'>
ref expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/ref.html'>
ref
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/registerp.html'>
registerp expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/registerp.html'>
registerp
</a>
</li>
</ul>
<li>
<a href='/ruote_website/rel.html'>
rel values for ruote-http / ruote-kit links
</a>
</li>
<li>
<a href='/ruote_website/exp/reserve.html'>
reserve expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/reserve.html'>
reserve
</a>
</li>
</ul>
<li>
<a href='/ruote_website/resources.html'>
resources
</a>
</li>
<li>
<a href='/ruote_website/exp/restore.html'>
restore expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/restore.html'>
restore
</a>
</li>
<li>
<a href='/ruote_website/exp/restore.html'>
set_fields
</a>
</li>
</ul>
<li>
<a href='/ruote_website/part/rev_participant.html'>
rev_participant
</a>
</li>
<li>
<a href='/ruote_website/users.html'>
ruote users
</a>
</li>
<li>
<a href='/ruote_website/sample_workflow_run.html'>
sample workflow run
</a>
</li>
<li>
<a href='/ruote_website/exp/save.html'>
save expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/save.html'>
save
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/sequence.html'>
sequence expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/sequence.html'>
sequence
</a>
</li>
<li>
<a href='/ruote_website/exp/sequence.html'>
let
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/set.html'>
set expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/set.html'>
rset
</a>
</li>
<li>
<a href='/ruote_website/exp/set.html'>
set
</a>
</li>
<li>
<a href='/ruote_website/exp/set.html'>
unset
</a>
</li>
</ul>
<li>
<a href='/ruote_website/part/smtp_participant.html'>
smtp_participant
</a>
</li>
<li>
<a href='/ruote_website/source.html'>
source
</a>
</li>
<li>
<a href='/ruote_website/exp/stall.html'>
stall expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/stall.html'>
stall
</a>
</li>
</ul>
<li>
<a href='/ruote_website/part/storage_participant.html'>
storage_participant
</a>
</li>
<li>
<a href='/ruote_website/exp/subprocess.html'>
subprocess expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/subprocess.html'>
subprocess
</a>
</li>
</ul>
<li>
<a href='/ruote_website/testing_participants.html'>
testing participants
</a>
</li>
<li>
<a href='/ruote_website/testing_processes.html'>
testing processes
</a>
</li>
<li>
<a href='/ruote_website/exp/that.html'>
that expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/that.html'>
that
</a>
</li>
<li>
<a href='/ruote_website/exp/that.html'>
of
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/undo.html'>
undo expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/undo.html'>
undo
</a>
</li>
<li>
<a href='/ruote_website/exp/undo.html'>
cancel
</a>
</li>
<li>
<a href='/ruote_website/exp/undo.html'>
kill
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/unregisterp.html'>
unregisterp expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/unregisterp.html'>
unregisterp
</a>
</li>
</ul>
<li>
<a href='/ruote_website/vars_and_fields.html'>
variables and fields
</a>
</li>
<li>
<a href='/ruote_website/exp/wait.html'>
wait expression
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/wait.html'>
wait
</a>
</li>
<li>
<a href='/ruote_website/exp/wait.html'>
sleep
</a>
</li>
</ul>
<li>
<a href='/ruote_website/with_rails.html'>
with rails
</a>
</li>
<li>
<a href='/ruote_website/patterns.html'>
workflow control patterns
</a>
</li>
<li>
<a href='/ruote_website/ja.html'>
日本語
</a>
</li>
</ul>
<h3>
More
</h3>
<ul class='contact'>
<li>
<a href='https://github.com/jmettraux/ruote/tree/master/quickstart'>
quickstart
</a>
</li>
<li>
<a href='/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/resources.html'>
resources
</a>
</li>
<li>
<a href='/users.html'>
users
</a>
</li>
</ul>
<h3>
Meta
</h3>
<ul class='contact'>
<li>
<a href='/source.html'>
source
</a>
</li>
<li>
<a href='/download.html'>
download
</a>
</li>
<li>
<a href='http://jmettraux.github.com'>
blog
</a>
</li>
<li>
<a href='/lists.html'>
mailing list
</a>
</li>
<li>
<a href='http://ruote-ci.s3.amazonaws.com/ci.html'>
continuous integration
</a>
</li>
<li>
<a href='http://ruote-irclogs.s3.amazonaws.com/logs.html'>
IRC
</a>
</li>
<li>
<a href='https://www.ohloh.net/p/ruote/'>
on ohloh
</a>
</li>
</ul>
<h3>
<span>
Search
</span>
</h3>
<ul class='contact'>
<li>
<form action='http://www.google.com/search' method='GET'>
<input id='qq' name='qq' style='' type='text'>
<input id='q' name='q' type='hidden'>
<input onclick='adjustSearch();' type='submit' value='search'>
</form>
</li>
</ul>
<script>
  function adjustSearch() {
    $('#q').val($('#qq').val() + ' site:http://ruote.rubyforge.org');
  }
</script>
</div>
<div id='content-main'>
<h2>configuration</h2>
<p>Before evoking configuration it&#8217;s perhaps a good idea to have a look at the <a href="http://jmettraux.wordpress.com/2009/12/31/ruote-2-1-released/">post announcing ruote 2.1</a>, it&#8217;s detailing the design decisions behind ruote 2.1. It helps understand the 3 objects detailed in this page, <a href="#engine">engine</a>, <a href="#worker">worker</a> and <a href="#storage">storage</a>.</p>
<p>In ruote 2.1, the engine <em>class</em> became shallow, just a few methods that insert launch and reply orders in the storage and read it when querying for process statuses.</p>
<p>The <em>real</em> engine is composed of a storage (persistent core) and of one or more workers.</p>
<p>Storage implementations are meant to be process/thread safe, ie they can be used by multiple worker processes and engines.</p>
<p>The engine <em>class</em> is nothing more than a dashboard, with indicators and a few knobs.</p>
<p>This is the ruote configuration you can see in the <a href="index.html">entry page</a> of this documentation :</p>
<pre class="brush: ruby">
require 'ruote'
require 'ruote/storage/fs_storage'

engine = Ruote::Engine.new(Ruote::Worker.new(Ruote::FsStorage.new('work')))
</pre>
<p>This is a super-vanilla configuration. Packaging the engine, a worker, and the storage together.</p>
<p>Using <a href="http://github.com/jmettraux/ruote-dm">ruote-dm</a> <a href="http://datamapper.org/">DataMapper</a> persistence, an engine/worker initalization would look like :</p>
<pre class="brush: ruby">
require 'ruote'
require 'ruote/dm/storage'

engine = Ruote::Engine.new(
  Ruote::Worker.new(
    Ruote::Dm::DmStorage.new(:default)))
</pre>
<p>Where :default simply indicates, we&#8217;ll want to work with the default configured DataMapper repository.</p>
<hr />
<h3 id="engine">engine</h3>
<p>Engine options are in fact passed to the storage at initialization time.</p>
<pre class="brush: ruby">
require 'ruote'
require 'ruote/storage/fs_storage'

engine = Ruote::Engine.new(
  Ruote::Worker.new(
    Ruote::FsStorage.new(
      'work',
      'remote_definition_allowed' =&gt; true, 'ruby_eval_allowed' =&gt; true)))
</pre>
<p>They can also be set directly in the storage (document type &#8216;configurations&#8217;, key &#8216;engine&#8217;), but that&#8217;s an advanced technique (and you don&#8217;t want/need to change it at runtime).</p>
<p>Some people might prefer writing :</p>
<pre class="brush: ruby">
engine = Ruote::Engine.new(
  Ruote::Worker.new(
    Ruote::FsStorage.new('work')))

engine.configure('remote_definition_allowed', true)
engine.configure('ruby_eval_allowed', true)
</pre>
<h3 id="engine_options">engine options</h3>
<ul>
	<li><strong>participant_threads_enabled</strong>: (from ruote 2.3.0 on)</li>
</ul>
<p>Defaults to true.</p>
<p>By default, the dispatching of workitems to participants is done in a new Ruby thread. The goal is not to block the worker with potentially lengthy operations. Dispatching via a <a href="http://www.reuters.com/article/2009/09/09/us-safrica-pigeon-idUSTRE5885PM20090909">homing pigeon</a>, for example, is a costly operation, you have to take the pigeon out of his cage, attach the message, and set it free&#8230; By default such blocking operations are performed in their own threads.</p>
<p>In deployments where multi-workers are the norm, having one worker blocked dispatching is no problem. In such contexts, turning off the threaded dispatching is OK.</p>
<ul>
	<li><strong>remote_definition_allowed</strong>:</li>
</ul>
<p>Defaults to false.</p>
<p>Remote definitions are process definitions reachable over <span class="caps">HTTP</span>. Since process definition are &#8216;code&#8217;, ruote, by default, prevents you from doing things like</p>
<pre class="brush: ruby">
Ruote.process_definition :name =&gt; 'main process' do
  sequence do
    subprocess 'http://example.com/definitions/head_process.rb'
    subprocess 'http://example.com/definitions/tail_process.rb'
  end
end

# or

engine.variables['head'] = 'http://example.com/definitions/head_process.rb'
engine.variables['tail'] = 'http://example.com/definitions/tail_process.rb'

Ruote.process_definition :name =&gt; 'main process' do
  sequence do
    head
    tail
  end
end

# or simply

engine.launch('http://example.com/definitions/main.xml')
</pre>
<p>You have to explicitely set &#8216;remote_definition_allowed&#8217; to true.</p>
<ul>
	<li><strong>ruby_eval_allowed</strong>:</li>
</ul>
<p>Defaults to false.</p>
<p>More about this option in the page about the <a href="dollar.html#ruby_eval_allowed">dollar notation</a>.</p>
<ul>
	<li><strong>wait_logger_max</strong>:</li>
</ul>
<p>Defaults to 147.</p>
<p>(this setting only makes sense in &#8220;1 worker &#8211; test/development&#8221; environments, in other environments, just leave it alone)</p>
<p>The WaitLogger is a component inside of ruote that keeps track of the 147 latest messages processed by the local worker (if any). This 147 number can be tuned thanks to the &#8216;wait_logger_max&#8217; option.</p>
<ul>
	<li><strong>preserve_configuration</strong>:</li>
</ul>
<p>Default to false.</p>
<p>More of a storage configuration. When set to true, the engine/worker/storage group will not write any configuration to the persistence behind the storage. It will simply read.</p>
<p>This option is useful in multi-worker setting, when configuration is done once and then read by the workers.</p>
<ul>
	<li><strong>restless_worker</strong>:</li>
</ul>
<p>Defaults to false.</p>
<p>More of a worker configuration. When set to true, the worker will not sleep between its storage polls for msgs and schedules to execute. This option is set to true by some storage implementations, those that block in a connection with their persistence backend and get pushed msgs and/or schedules.</p>
<p>Safely ignore this option.</p>
<ul>
	<li><strong>worker_state_enabled</strong>:</li>
</ul>
<p>Defaults to false.</p>
<p>When set to true, &#8220;unlocks&#8221; the #worker_state= method of Ruote::Dashboard (Ruote::Engine). Possible states are &#8220;running&#8221; (default), &#8220;paused&#8221; and &#8220;stopped&#8221;. Workers reads that state and pause/resume/stop accordingly. Please note that a stopped worker won&#8217;t read state further since it&#8217;s stopped and gone, use &#8220;paused&#8221; for pause/resume.</p>
<h3 id="engine_on">engine on_error / on_terminate</h3>
<p>There are the <a href="http://localhost:3000/common_attributes.html#on_error">on_error</a> and the <a href="http://localhost:3000/common_attributes.html#on_cancel">on_cancel</a> attributes common to all expressions. Engine#on_error and #on_terminate are quite close to those, but there is an important catch. The on_error attribute will cancel the expression to which it is attached and then run the on_error &#8216;routine&#8217;, while Engine#on_error runs independently of the process whose error triggered the reaction. Same thing for on_terminate.</p>
<p>The processes triggered by on_error and on_terminate are independent processes (but they do not trigger further on_error / on_terminate, cascade prevention).</p>
<p>Looking at the functional tests for <a href="https://github.com/jmettraux/ruote/blob/master/test/functional/ft_49_engine_on_error.rb">on_error</a> and <a href="https://github.com/jmettraux/ruote/blob/master/test/functional/ft_53_engine_on_terminate.rb">on_terminate</a> might help understand.</p>
<h4 id="engine_on_error">on_error</h4>
<p>Each time an unchecked error occurs in a process instance, the participant or the subprocess given in on_error will get triggered.</p>
<pre class="brush: ruby">
# you can pass a participant name
engine.on_error = 'administrator'

# or a subprocess name
engine.on_error = 'error_procedure'

# or directly a subprocess definition
engine.on_error = Ruote.define do
  concurrence do
    administrator :msg =&gt; 'something went wrong'
    supervisor :msg =&gt; 'something went wrong'
  end
end
</pre>
<p>The workitem used in the on_error &#8220;handler&#8221; is a copy of the workitem at the error point.</p>
<h4 id="engine_on_terminate">engine on_terminate</h4>
<p>This handler launches a subprocess each time a process instance terminates in a regular way.</p>
<p>Its usage is similar to Engine#on_error :</p>
<pre class="brush: ruby">
# you can pass a participant name
engine.on_terminate = 'archiver'

# or a subprocess name
engine.on_terminate = 'archival_procedure'

# or directly a subprocess definition
engine.on_terminate = Ruote.define do
  concurrence do
    supervisor :msg =&gt; 'process ${wfid} terminated'
    archiver
  end
end
</pre>
<p>The workitem passed to the triggered process instance is a copy of the one in the process that just terminated.</p>
<hr />
<h3 id="worker">worker</h3>
<p>As of now, there are no configuration options for workers. They don&#8217;t complain, they are not syndicated, they just work.</p>
<hr />
<h3 id="storage">storage</h3>
<p>Workflows / business processes usually involve real persons, humans. They are slower than computers. These days processes also imply multiple systems / services. These two things imply that workflows / processes may last a long time. Persistence is necessary, this is done with the storage.</p>
<p>Since workers share the storage, it has not only to provide reliable persistence but also helpers to avoid worker collisions.</p>
<p>The following table summarizes the various storage implementations.</p>
<p><strong>multiple workers</strong> tells if yes or no the storage supports multiple workers;<br />
<strong>remote worker</strong> indicates if workers not on the same host as the storage are possible;<br />
<strong>speed</strong> is a relative indication of the speed of the storage.</p>
<table>
	<tr>
		<th>storage</th>
		<th>multiple workers ?</th>
		<th>remote workers ?</th>
		<th>speed</th>
		<th></th>
	</tr>
	<tr>
		<td><a href="#hash_storage">Ruote::HashStorage</a> </td>
		<td> no (1) </td>
		<td> no </td>
		<td> best </td>
		<td> in-memory storage, limited to the current ruby process, totally transient</td>
	</tr>
	<tr>
		<td><a href="#fs_storage">Ruote::FsStorage</a> </td>
		<td> yes (2) </td>
		<td> no </td>
		<td> 2nd </td>
		<td> hierarchy of <span class="caps">JSON</span> files, uses file locks to prevent collisions when multiple workers</td>
	</tr>
	<tr>
		<td><a href="#redis_storage">Ruote::Redis::Storage</a> </td>
		<td> yes </td>
		<td> yes </td>
		<td> 1st </td>
		<td> <a href="http://redis.io">Redis</a> based persistence</td>
	</tr>
	<tr>
		<td><a href="#sequel_storage">Ruote::Sequel::Storage</a> </td>
		<td> yes </td>
		<td> yes </td>
		<td> 4th </td>
		<td> <a href="http://sequel.rubyforge.org">Sequel</a> based persistence</td>
	</tr>
	<tr>
		<td><a href="https://github.com/ifad/ruote-postgres">ruote-postgres</a> </td>
		<td> yes </td>
		<td> yes </td>
		<td> 4th </td>
		<td> persistence directly based on <a href="http://postgresql.org">PostgreSQL</a></td>
	</tr>
	<tr>
		<td><a href="#mongo_storage">Ruote::Mon::Storage</a> </td>
		<td> yes </td>
		<td> yes </td>
		<td> like the Redis storage </td>
		<td> <a href="http://www.mongodb.org">MongoDB</a> based persistence</td>
	</tr>
	<tr>
		<td><a href="#beanstalk_storage">Ruote::Beanstalk::Storage</a> </td>
		<td> yes </td>
		<td> yes </td>
		<td> 3rd </td>
		<td> FsStorage based persistence with a <a href="http://kr.github.com/beanstalkd/">Beanstalk</a> front</td>
	</tr>
	<tr>
		<td><a href="#dm_storage">Ruote::Dm::Storage</a> </td>
		<td> yes (3) </td>
		<td> yes </td>
		<td> 5th </td>
		<td> <a href="http://datamapper.org">DataMapper</a> based persistence (not maintained anymore)</td>
	</tr>
	<tr>
		<td><a href="#couch_storage">Ruote::Couch::Storage</a> </td>
		<td> yes </td>
		<td> yes </td>
		<td> slowest </td>
		<td> <a href="http://couchdb.apache.org/">Apache CouchDB</a> based persistence, very slow (not maintained anymore)</td>
	</tr>
</table>
<p>(1) well, it&#8217;s &#8216;yes&#8217; but there isn&#8217;t much to gain from one more worker in the same Ruby runtime<br />
(2) multiple workers, but not on Windows<br />
(3) &#8220;no&#8221; before ruote-dm 2.2.0</p>
<h4 id="hash_storage">Ruote::HashStorage</h4>
<p><a href="http://github.com/jmettraux/ruote/blob/master/lib/ruote/storage/hash_storage.rb">source</a></p>
<p>A completely transient, in-memory storage for ruote. Cannot be shared by multiple workers. Mostly used for testing or for transient workflows.</p>
<h4 id="fs_storage">Ruote::FsStorage</h4>
<p><a href="http://github.com/jmettraux/ruote/blob/master/lib/ruote/storage/fs_storage.rb">source</a></p>
<p>Stores ruote information into a hierarchy of <span class="caps">JSON</span> files. Can be shared by multiple workers (though on the same host).</p>
<p>Rather fast. Easy to use (just a bunch of files).</p>
<p>Doesn&#8217;t work with multiple workers on Windows (the file locking mechanism it uses is not supported on this platform).</p>
<h4 id="redis_storage">Ruote::Redis::Storage</h4>
<p><a href="http://github.com/jmettraux/ruote-redis/blob/master/lib/ruote/redis/storage.rb">source</a></p>
<p>A <a href="http://redis.io">redis</a> based storage. Very fast, usable by multiple workers (remotely).</p>
<h4 id="sequel_storage">Ruote::Sequel::Storage</h4>
<p><a href="http://github.com/jmettraux/ruote-sequel/blob/master/lib/ruote/sequel/storage.rb">source</a></p>
<p>A <a href="http://sequel.rubyforge.org">Sequel</a> persistence. Tested with <a href="http://www.postgresql.org">PostgreSQL</a> and <a href="http://mysql.org">MySQL</a>. OK with multiple workers.</p>
<p>ruote-dm and ruote-sequel share the same schema (1 table).</p>
<h4 id="dm_storage">Ruote::Dm::Storage</h4>
<p><a href="http://github.com/jmettraux/ruote-dm/blob/master/lib/ruote/dm/storage.rb">source</a></p>
<p>A <a href="http://datamapper.org/">DataMapper</a> storage implementation. OK with multiple workers (since ruote-dm 2.2.0).</p>
<p>ruote-dm and ruote-sequel share the same schema (1 table).</p>
<h4 id="couch_storage">Ruote::Couch::Storage</h4>
<p><a href="http://github.com/jmettraux/ruote-couch/tree/master/lib/ruote/couch/">source</a></p>
<p>A <a href="http://couchdb.apache.org/">CouchDB</a> storage implementation. OK with multiple workers.</p>
<p>It&#8217;s rather slow. People tend to use it to store workitems, and let the msgs and schedules be stored in faster implementations (see <a href="#composite_storage">CompositeStorage</a>).</p>
<h4 id="mongo_storage">Ruote::Mon::Storage</h4>
<p><a href="https://github.com/jmettraux/ruote-mon/blob/master/lib/ruote/mon/storage.rb">source</a></p>
<p><a href="http://mongodb.org">MongoDB</a> storage implementation.</p>
<h4 id="beanstalk_storage">Ruote::Beanstalk::BsStorage</h4>
<p>This storage is an experiment. It uses a set of <a href="http://kr.github.com/beanstalkd/">beanstalk</a> tubes to make a FsStorage available to remote workers.</p>
<p><a href="http://github.com/jmettraux/ruote-beanstalk/blob/master/lib/ruote/beanstalk/storage.rb">source</a></p>
<h4 id="composite_storage">composite storage</h4>
<p><a href="http://github.com/jmettraux/ruote/blob/master/lib/ruote/storage/composite_storage.rb">source</a></p>
<p>The &#8220;composite&#8221; storage lets you select which storage to use for which category of object to be persisted. Here is a table detailing those &#8216;categories&#8217; :</p>
<table>
	<tr>
		<th>type         </th>
		<th>description</th>
	</tr>
	<tr>
		<td>expressions    </td>
		<td>the atomic pieces of process instance</td>
	</tr>
	<tr>
		<td>msgs           </td>
		<td>&#8216;messages&#8217; to apply/reply to expressions</td>
	</tr>
	<tr>
		<td>schedules      </td>
		<td>msgs scheduled for later processing</td>
	</tr>
	<tr>
		<td>errors         </td>
		<td>errors that occured during process execution (msgs processing)</td>
	</tr>
	<tr>
		<td>variables      </td>
		<td>engine (global) variables</td>
	</tr>
	<tr>
		<td>configurations </td>
		<td>engine configurations</td>
	</tr>
	<tr>
		<td>workitems      </td>
		<td><a href="part/storage_participant.html">StorageParticipant</a> workitems</td>
	</tr>
	<tr>
		<td><em>history</em>      </td>
		<td>(if you use <a href="https://github.com/jmettraux/ruote/blob/master/lib/ruote/log/storage_history.rb">Ruote::StorageHistory</a>)</td>
	</tr>
</table>
<p>An example where everything is handled by a FsStorage while the &#8216;msgs&#8217; are stored in a HashStorage :</p>
<pre class="brush: ruby">
  opts = {
    'remote_definition_allowed' =&gt; true,
    'ruby_eval_allowed' =&gt; true
  }

  engine =
    Ruote::Engine.new(
      Ruote::Worker.new(
        Ruote::CompositeStorage.new(
          Ruote::FsStorage.new('ruote_work', opts),
          'msgs' =&gt; Ruote::HashStorage.new(opts))))
</pre>
</div>
</div>
</div>
</div>
<div id='footer'>
<div id='footer-center'>
<p>
<span id='footer-left'>
<a href='https://github.com/jmettraux/ruote_website/issues'>doc issue reporting</a>
|
<a href='https://github.com/jmettraux/ruote_website'>doc source</a>
| created with
<a href='http://nanoc.stoneship.org'>nanoc</a>
and
<a href='http://alexgorbatchev.com/SyntaxHighlighter/'>syntax highlighter</a>
</span>
<span id='footer-right'>
&copy; 2005-2013 the ruote team
</span>
</p>
</div>
</div>
<script>
  SyntaxHighlighter.all();
</script>
</body>
</html>
