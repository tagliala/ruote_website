<!DOCTYPE html>
<html><head>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<title>ruote - with rails</title>
<script src='/ruote_website/js/shCore.js'></script>
<script src='/ruote_website/js/shBrushXml.js'></script>
<script src='/ruote_website/js/shBrushBash.js'></script>
<script src='/ruote_website/js/shBrushRuby.js'></script>
<script src='/ruote_website/js/shBrushJScript.js'></script>
<!-- %script{ :src => "/js/jquery-1.6.1.min.js" } -->
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js'></script>
<link href='/ruote_website/css/reset.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shCore.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shThemeRuote.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/ruote.css' rel='stylesheet' type='text/css'>
</head><body>
<div id='container'>
<div id='header'>
<div id='header-center'>
<div id='header-left'>
<a href='/ruote_website'>
<img src='/ruote_website/images/ruote.png'>
</a>
<div id='header-subtitle'>
a ruby workflow engine
</div>
</div>
<div id='header-right'>
<div id='nav'>
<span>
<a href='/ruote_website/documentation.html' title='documentation'>
doc
</a>
<a href='/ruote_website/source.html' title='source code'>
source
</a>
<a href='/ruote_website/download.html' title='download'>
download
</a>
<a class='nihongo' href='/ja.html' title='日本語'>
日本語
</a>
</span>
</div>
</div>
</div>
</div>
<div id='content'>
<div id='content-center'>
<div id='sidebar'><h3 onclick='document.location = &quot;/ruote_website/documentation.html&quot;' style='cursor: pointer'>
Documentation
</h3>
<ul>
<li>
<a href='/ruote_website/common_attributes.html'>
common attributes
</a>
</li>
<li>
<a href='/ruote_website/conditions.html'>
conditions
</a>
</li>
<li>
<a href='/ruote_website/configuration.html'>
configuration
</a>
</li>
<li>
<a href='/ruote_website/documentation.html'>
documentation
</a>
</li>
<li>
<a href='/ruote_website/dollar.html'>
dollar notation
</a>
</li>
<li>
<a href='/ruote_website/download.html'>
download
</a>
</li>
<li>
<a href='/ruote_website/expressions.html'>
expressions
</a>
</li>
<li>
<a href='/ruote_website/glossary.html'>
glossary
</a>
</li>
<li>
<a href='/ruote_website/implementing_a_storage.html'>
implementing a storage
</a>
</li>
<li>
<a href='/ruote_website/implementing_participants.html'>
implementing participants
</a>
</li>
<li>
<a href='/ruote_website/lists.html'>
lists
</a>
</li>
<li>
<a href='/ruote_website/noisy.html'>
noisy output
</a>
</li>
<li>
<a href='/ruote_website/part_implementations.html'>
participant implementations
</a>
</li>
<li>
<a href='/ruote_website/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/ruote_website/process_administration.html'>
process administration
</a>
</li>
<li>
<a href='/ruote_website/definitions.html'>
process definitions
</a>
</li>
<li>
<a href='/ruote_website/process_observation.html'>
process observation
</a>
</li>
<li>
<a href='/ruote_website/participants.html'>
process participants
</a>
</li>
<li>
<a href='/ruote_website/rel.html'>
rel values for ruote-http / ruote-kit links
</a>
</li>
<li>
<a href='/ruote_website/resources.html'>
resources
</a>
</li>
<li>
<a href='/ruote_website/users.html'>
ruote users
</a>
</li>
<li>
<a href='/ruote_website/sample_workflow_run.html'>
sample workflow run
</a>
</li>
<li>
<a href='/ruote_website/source.html'>
source
</a>
</li>
<li>
<a href='/ruote_website/testing_participants.html'>
testing participants
</a>
</li>
<li>
<a href='/ruote_website/testing_processes.html'>
testing processes
</a>
</li>
<li>
<a href='/ruote_website/vars_and_fields.html'>
variables and fields
</a>
</li>
<li class='current'>
<a href='/ruote_website/with_rails.html'>
with rails
</a>
</li>
<li>
<a href='/ruote_website/patterns.html'>
workflow control patterns
</a>
</li>
<li>
<a href='/ruote_website/ja.html'>
日本語
</a>
</li>
</ul>
<h3>
More
</h3>
<ul class='contact'>
<li>
<a href='https://github.com/jmettraux/ruote/tree/master/quickstart'>
quickstart
</a>
</li>
<li>
<a href='/ruote_website/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/ruote_website/resources.html'>
resources
</a>
</li>
<li>
<a href='/ruote_website/users.html'>
users
</a>
</li>
</ul>
<h3>
Meta
</h3>
<ul class='contact'>
<li>
<a href='/ruote_website/source.html'>
source
</a>
</li>
<li>
<a href='/ruote_website/download.html'>
download
</a>
</li>
<li>
<a href='http://jmettraux.github.com'>
blog
</a>
</li>
<li>
<a href='/ruote_website/lists.html'>
mailing list
</a>
</li>
<li>
<a href='http://ruote-ci.s3.amazonaws.com/ci.html'>
continuous integration
</a>
</li>
<li>
<a href='http://ruote-irclogs.s3.amazonaws.com/logs.html'>
IRC
</a>
</li>
<li>
<a href='https://www.ohloh.net/p/ruote/'>
on ohloh
</a>
</li>
</ul>
<h3>
<span>
Search
</span>
</h3>
<ul class='contact'>
<li>
<form action='http://www.google.com/search' method='GET'>
<input id='qq' name='qq' style='' type='text'>
<input id='q' name='q' type='hidden'>
<input onclick='adjustSearch();' type='submit' value='search'>
</form>
</li>
</ul>
<script>
  function adjustSearch() {
    $('#q').val($('#qq').val() + ' site:http://ruote.rubyforge.org');
  }
</script>
</div>
<div id='content-main'>
<h2>ruote on rails</h2>
<p>Many people use <a href="http://rubyonrails.org/">Ruby on Rails</a> to implement their front ends. The question &#8220;how do I integrate ruote into my Rails application?&#8221; comes up often.</p>
<p>Ruote-kit is often the answer, but not always since it brings some (few) dependencies.</p>
<p>Most of the time, people integrating ruote inside of Rails want a simple setup where the ruote worker sits in the Rails application (the worker thread lives next to the Rails server thread), but this doesn&#8217;t play well with all the Rails deployment options. If you have, let&#8217;s say, a Unicorn setup spawning 5 processes, you&#8217;ll end up with 5 ruote worker threads and you&#8217;ll need to use a multi-worker safe ruote storage (see <a href="configuration.html">configuration</a>).</p>
<p>One has to decide whether he wants his ruote workers to run inside of the Rails application or outside, as standalone / daemon workers.</p>
<h3 id="ruote_kit">with ruote-kit</h3>
<p>The ruote-kit <a href="https://github.com/kennethkalmer/ruote-kit"><span class="caps">README</span></a> should help setting up ruote-kit (standalone or as a Rails add-on).</p>
<p>If it&#8217;s not clear enough, feel free to fire a question on the <a href="http://groups.google.com/group/openwferu-users">ruote mailing-list</a> or fork the project and fix the <span class="caps">README</span> (send a pull request).</p>
<p>The ruote-kit <span class="caps">README</span> has a section dedicated to <a href="https://github.com/kennethkalmer/ruote-kit#running-workers">running workers as daemons</a>.</p>
<h3 id="simple">without ruote-kit</h3>
<p>Ruote-kit is not mandatory.</p>
<h4 id="gemfile">add ruote and its storage to your Gemfile</h4>
<pre class="brush: ruby">
gem 'ruote', :git =&gt; 'git://github.com/jmettraux/ruote.git'
gem 'ruote-redis', :git =&gt; 'git://github.com/jmettraux/ruote-redis.git'
  #
  # living on edge, ruote 2.3.0 from "master"
</pre>
<h4 id="initializer">add a config/initializers/ruote.rb file</h4>
<p>This sample initializer uses ruote-redis as the storage, references it via a RUOTE_STORAGE constant and places the ruote dashboard behind a <span class="caps">RUOTE</span> constant. If you deem it more elegant you can also place the dashboard behind a singleton like Ruote.dashboard.</p>
<pre class="brush: ruby">
require 'redis'
require 'ruote'
require 'ruote-redis'

#
# set up ruote storage

RUOTE_STORAGE = Ruote::Redis::Storage.new(
  ::Redis.new(:db =&gt; 14, :thread_safe =&gt; true), {})

#
# set up ruote dashboard

RUOTE = if defined?(Rake)
  #
  # do not start a ruote worker in a rake task
  #
  Ruote::Dashboard.new(RUOTE_STORAGE)
else
  #
  # start a worker
  #
  Ruote::Dashboard.new(Ruote::Worker.new(RUOTE_STORAGE))
end

#
# participant registration

RUOTE.register do
  participant 'notifier', Acme::Participants::Notifier
  participant /user_.+/, Ruote::StorageParticipant
end
</pre>
<p>If you want to run a worker outside of the Rails application, you can adopt a much simpler setup:</p>
<pre class="brush: ruby">
require 'redis'
require 'ruote'
require 'ruote-redis'

#
# set up ruote storage

RUOTE_STORAGE = Ruote::Redis::Storage.new(
  ::Redis.new(:db =&gt; 14, :thread_safe =&gt; true), {})

#
# set up ruote dashboard

RUOTE = Ruote::Dashboard.new(RUOTE_STORAGE)

#
# participant registration

RUOTE.register do
  participant 'notifier', Acme::Participants::Notifier
  participant /user_.+/, Ruote::StorageParticipant
end
</pre>
<p>You could even drop the participant registration in the Rails app and leave it for the worker script.</p>
<h4 id="worker">sample worker script</h4>
<p>Warning, this script has no daemonization going on (if you&#8217;d like to help with that, just manifest yourself on the mailing list).</p>
<pre class="brush: ruby">
require 'redis'
require 'ruote'
require 'ruote-redis'

#
# set up ruote storage

RUOTE_STORAGE = Ruote::Redis::Storage.new(
  ::Redis.new(:db =&gt; 14, :thread_safe =&gt; true), {})

#
# set up ruote dashboard

RUOTE = Ruote::Dashboard.new(Ruote::Worker.new(RUOTE_STORAGE))

#
# participant registration

RUOTE.register do
  participant 'notifier', Acme::Participants::Notifier
  participant /user_.+/, Ruote::StorageParticipant
end

#
# let's join the worker thread (prevents the script from exiting)

RUOTE.join
</pre>
</div>
</div>
</div>
</div>
<div id='footer'>
<div id='footer-center'>
<p>
<span id='footer-left'>
<a href='https://github.com/jmettraux/ruote_website/issues'>doc issue reporting</a>
|
<a href='https://github.com/jmettraux/ruote_website'>doc source</a>
| created with
<a href='http://nanoc.stoneship.org'>nanoc</a>
and
<a href='http://alexgorbatchev.com/SyntaxHighlighter/'>syntax highlighter</a>
</span>
<span id='footer-right'>
&copy; 2005-2013 the ruote team
</span>
</p>
</div>
</div>
<script>
  SyntaxHighlighter.all();
</script>
</body>
</html>
