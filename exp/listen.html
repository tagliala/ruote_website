<!DOCTYPE html>
<html><head>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<title>ruote - listen expression</title>
<script src='/ruote_website/js/shCore.js'></script>
<script src='/ruote_website/js/shBrushXml.js'></script>
<script src='/ruote_website/js/shBrushBash.js'></script>
<script src='/ruote_website/js/shBrushRuby.js'></script>
<script src='/ruote_website/js/shBrushJScript.js'></script>
<!-- %script{ :src => "/js/jquery-1.6.1.min.js" } -->
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js'></script>
<link href='/ruote_website/css/reset.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shCore.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shThemeRuote.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/ruote.css' rel='stylesheet' type='text/css'>
</head><body>
<div id='container'>
<div id='header'>
<div id='header-center'>
<div id='header-left'>
<a href='/ruote_website'>
<img src='/ruote_website/images/ruote.png'>
</a>
<div id='header-subtitle'>
a ruby workflow engine
</div>
</div>
<div id='header-right'>
<div id='nav'>
<span>
<a href='/ruote_website/documentation.html' title='documentation'>
doc
</a>
<a href='/ruote_website/source.html' title='source code'>
source
</a>
<a href='/ruote_website/download.html' title='download'>
download
</a>
<a class='nihongo' href='/ja.html' title='日本語'>
日本語
</a>
</span>
</div>
</div>
</div>
</div>
<div id='content'>
<div id='content-center'>
<div id='sidebar'><h3 onclick='document.location = &quot;/ruote_website/documentation.html&quot;' style='cursor: pointer'>
Documentation
</h3>
<ul>
<li>
<a href='/ruote_website/exp/add_branches.html'>
add_branches
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/add_branches.html'>
add_branch
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/apply.html'>
apply
</a>
</li>
<li>
<a href='/ruote_website/exp/await.html'>
await
</a>
</li>
<li>
<a href='/ruote_website/exp/cancel_process.html'>
cancel_process
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/cancel_process.html'>
terminate
</a>
</li>
<li>
<a href='/ruote_website/exp/cancel_process.html'>
kill_process
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/command.html'>
command
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/command.html'>
skip
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
back
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
jump
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
rewind
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
continue
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
break
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
stop
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
over
</a>
</li>
<li>
<a href='/ruote_website/exp/command.html'>
reset
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/concurrence.html'>
concurrence
</a>
</li>
<li>
<a href='/ruote_website/exp/concurrent_iterator.html'>
concurrent_iterator
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/concurrent_iterator.html'>
citerator
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/cron.html'>
cron
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/cron.html'>
every
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/cursor.html'>
cursor
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/cursor.html'>
loop
</a>
</li>
<li>
<a href='/ruote_website/exp/cursor.html'>
repeat
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/define.html'>
define
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/define.html'>
process_definition
</a>
</li>
<li>
<a href='/ruote_website/exp/define.html'>
workflow_definition
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/echo.html'>
echo
</a>
</li>
<li>
<a href='/ruote_website/exp/equals.html'>
equals
</a>
</li>
<li>
<a href='/ruote_website/exp/error.html'>
error
</a>
</li>
<li>
<a href='/ruote_website/exp/filter.html'>
filter
</a>
</li>
<li>
<a href='/ruote_website/exp/forget.html'>
forget
</a>
</li>
<li>
<a href='/ruote_website/exp/given.html'>
given
</a>
</li>
<li>
<a href='/ruote_website/exp/if.html'>
if
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
inc
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/inc.html'>
dec
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
increment
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
decrement
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
push
</a>
</li>
<li>
<a href='/ruote_website/exp/inc.html'>
pop
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/iterator.html'>
iterator
</a>
</li>
<li>
<a href='/ruote_website/exp/let.html'>
let
</a>
</li>
<li class='current'>
<a href='/ruote_website/exp/listen.html'>
listen
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/listen.html'>
receive
</a>
</li>
<li>
<a href='/ruote_website/exp/listen.html'>
intercept
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/lose.html'>
lose
</a>
</li>
<li>
<a href='/ruote_website/exp/noop.html'>
noop
</a>
</li>
<li>
<a href='/ruote_website/exp/on_error.html'>
on_error
</a>
</li>
<li>
<a href='/ruote_website/exp/once.html'>
once
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/once.html'>
when
</a>
</li>
<li>
<a href='/ruote_website/exp/once.html'>
as_soon_as
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/participant.html'>
participant
</a>
</li>
<li>
<a href='/ruote_website/exp/read.html'>
read
</a>
</li>
<li>
<a href='/ruote_website/exp/redo.html'>
redo
</a>
</li>
<li>
<a href='/ruote_website/exp/ref.html'>
ref
</a>
</li>
<li>
<a href='/ruote_website/exp/registerp.html'>
registerp
</a>
</li>
<li>
<a href='/ruote_website/exp/reserve.html'>
reserve
</a>
</li>
<li>
<a href='/ruote_website/exp/restore.html'>
restore
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/restore.html'>
set_fields
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/save.html'>
save
</a>
</li>
<li>
<a href='/ruote_website/exp/sequence.html'>
sequence
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/sequence.html'>
let
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/set.html'>
set
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/set.html'>
rset
</a>
</li>
<li>
<a href='/ruote_website/exp/set.html'>
unset
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/stall.html'>
stall
</a>
</li>
<li>
<a href='/ruote_website/exp/subprocess.html'>
subprocess
</a>
</li>
<li>
<a href='/ruote_website/exp/that.html'>
that
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/that.html'>
of
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/undo.html'>
undo
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/undo.html'>
cancel
</a>
</li>
<li>
<a href='/ruote_website/exp/undo.html'>
kill
</a>
</li>
</ul>
<li>
<a href='/ruote_website/exp/unregisterp.html'>
unregisterp
</a>
</li>
<li>
<a href='/ruote_website/exp/wait.html'>
wait
</a>
</li>
<ul class='alias'>
<li>
<a href='/ruote_website/exp/wait.html'>
sleep
</a>
</li>
</ul>
</ul>
<h3>
More
</h3>
<ul class='contact'>
<li>
<a href='https://github.com/jmettraux/ruote/tree/master/quickstart'>
quickstart
</a>
</li>
<li>
<a href='/ruote_website/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/ruote_website/resources.html'>
resources
</a>
</li>
<li>
<a href='/ruote_website/users.html'>
users
</a>
</li>
</ul>
<h3>
Meta
</h3>
<ul class='contact'>
<li>
<a href='/ruote_website/source.html'>
source
</a>
</li>
<li>
<a href='/ruote_website/download.html'>
download
</a>
</li>
<li>
<a href='http://jmettraux.github.com'>
blog
</a>
</li>
<li>
<a href='/ruote_website/lists.html'>
mailing list
</a>
</li>
<li>
<a href='http://ruote-ci.s3.amazonaws.com/ci.html'>
continuous integration
</a>
</li>
<li>
<a href='http://ruote-irclogs.s3.amazonaws.com/logs.html'>
IRC
</a>
</li>
<li>
<a href='https://www.ohloh.net/p/ruote/'>
on ohloh
</a>
</li>
</ul>
<h3>
<span>
Search
</span>
</h3>
<ul class='contact'>
<li>
<form action='http://www.google.com/search' method='GET'>
<input id='qq' name='qq' style='' type='text'>
<input id='q' name='q' type='hidden'>
<input onclick='adjustSearch();' type='submit' value='search'>
</form>
</li>
</ul>
<script>
  function adjustSearch() {
    $('#q').val($('#qq').val() + ' site:http://ruote.rubyforge.org');
  }
</script>
</div>
<div id='content-main'>
<h2>listen</h2>
<p>Listens for activity (incoming or outgoing workitems) on a (set of)<br />
participant(s).</p>
<p>This expression is an advanced one. It allows for cross process instance<br />
communication or at least cross branch communication within the same<br />
process instance.</p>
<p>DO <span class="caps">NOT</span> confuse the listen expression with the &#8216;listener&#8217; concept. They are<br />
not directly related. The listen expression listens to workitem activity<br />
inside of the engine, while a listener listens for workitems or launchitems<br />
from sources external to the ruote workflow engine.</p>
<p>It can be used in two ways : &#8216;blocking&#8217; or &#8216;triggering&#8217;. In both cases<br />
the listen expression &#8216;reacts&#8217; upon activity (incoming or outgoing workitem)<br />
happening on a channel (a participant name or a tag name).</p>
<h3>blocking</h3>
<p>A blocking example :</p>
<pre class="brush: ruby">
  sequence do
    participant 'alice'
    listen :to =&gt; 'bob'
    participant 'charly'
  end
</pre>
<p>Once the listen expression got applied, this process will block until a<br />
workitem (in any other process instance in the same engine) is dispatched<br />
to participant &#8216;bob&#8217;. It then proceeds to charly.</p>
<h3>triggering</h3>
<p>This way of using &#8216;listen&#8217; is useful for launching processes that &#8220;stalk&#8221;<br />
other processes :</p>
<pre class="brush: ruby">
  Ruote.process_definition :name =&gt; 'stalker' do
    listen :to =&gt; 'bob' do
      participant :ref =&gt; 'charly'
    end
  end
</pre>
<p>This small process will never exits and will send a workitem to charly<br />
each time the ruote engine sends a workitem to bob.</p>
<p>The workitems passed to charly will be copies of the workitem initially<br />
applied to the &#8216;listen&#8217; expression, but with a copy of the fields of the<br />
workitem passed to bob, merged in.</p>
<p>Note : for now, the triggered segments of processes are &#8216;forgotten&#8217;. The<br />
&#8216;listen&#8217; expression doesn&#8217;t keep track of them. This also means that in<br />
case of cancel, the triggered segments will not get cancelled.</p>
<h3>:merge</h3>
<p>By default, :merge is set to true, the listened for workitems see their<br />
values merged into a copy of the workitem held in the listen expression<br />
and this copy is delivered to the expressions that are client to the<br />
&#8216;listen&#8217;.</p>
<p>:merge can be set to &#8216;override&#8217; where the event&#8217;s workitem fields are<br />
used or some value which isn&#8217;t true or &#8216;true&#8217;, in which case the<br />
workitem fields of the &#8216;listen&#8217; expression is used as is (as it was<br />
when the flow reached the &#8216;listen&#8217; expression).</p>
<h3>:upon</h3>
<p>There are two kinds of main events in ruote, apply and reply. Thus,<br />
a listen expression may listen to &#8216;apply&#8217; and to &#8216;reply&#8217; and this is<br />
defined by the :upon attribute.</p>
<p>By default, listens upon &#8216;apply&#8217; (engine handing workitem to participant).</p>
<p>Can be set to &#8216;reply&#8217;, to react on workitems being handed back to the<br />
engine by the participant.</p>
<p>Setting :upon to &#8216;entering&#8217; or &#8216;leaving&#8217; tells the listen to focus on<br />
tag events.</p>
<pre class="brush: ruby">
  sequence do
    sequence :tag =&gt; 'phase_one' do
      alpha
    end
    sequence :tag =&gt; 'phase_two' do
      bravo
    end
  end
</pre>
<p>In this dummy process definition, there are four tag events :</p>
<ul>
	<li>&#8216;entering&#8217; &#8216;phase_one&#8217;</li>
	<li>&#8216;leaving&#8217; &#8216;phase_one&#8217;</li>
	<li>&#8216;entering&#8217; &#8216;phase_two&#8217;</li>
	<li>&#8216;leaving&#8217; &#8216;phase_two&#8217;</li>
</ul>
<p>When listening to tags, absolute paths can be given.</p>
<pre class="brush: ruby">
  concurrence do
    sequence :tag =&gt; 'a' do
      alpha
      sequence :tag =&gt; 'b' do
        bravo
      end
    end
    sequence do
      listen :to =&gt; 'a/b', :upon =&gt; 'entering'
      charly
    end
   end
  end
</pre>
<p>Charly will be next when the flow is about to reach bravo.</p>
<h3>:to and :on</h3>
<p>The :to attribute has already been seen, it can be replaced by the :on one.</p>
<pre class="brush: ruby">
  listen :to =&gt; 'alpha'
</pre>
<p>is equivalent to</p>
<pre class="brush: ruby">
  listen :on =&gt; 'alpha'

</pre>
<h3>:to (:on) and regular expressions</h3>
<p>It&#8217;s OK to write things like :</p>
<pre class="brush: ruby">
  listen :to =&gt; "/^user\_.+/"
</pre>
<p>or</p>
<pre class="brush: ruby">
  listen :to =&gt; /^user\_.+/
</pre>
<p>To listen for workitems for all the participant whose name start with<br />
&#8220;user_&#8221;.</p>
<h3>:wfid</h3>
<p>By default, a listen expression listens for any workitem/participant event<br />
in the engine. Setting the :wfid attribute to &#8216;true&#8217; or &#8216;same&#8217; or &#8216;current&#8217;<br />
will make the listen expression only care for events belonging to the<br />
same process instance (same wfid).</p>
<h3>:where</h3>
<p>The :wfid can be considered a &#8216;guard&#8217;. Another tool for guarding listen<br />
is to use the :where attribute.</p>
<pre class="brush: ruby">
  listen :to =&gt; 'alpha', :where =&gt; '${customer.state} == CA'
</pre>
<p>The listen will trigger only if the workitem has a customer field with<br />
a subfield state containing the value &#8220;CA&#8221;.</p>
<p>The documentation about the dollar notation and the one about common<br />
attributes :if and :unless applies for the :where attribute.</p>
<h3>listen :to =&gt; :errors</h3>
<p>The listen expression can be made to listen to errors.</p>
<pre class="brush: ruby">
  listen :to =&gt; errors do
    participant 'supervisor_sms', :task =&gt; 'verify system'
  end
</pre>
<p>Whenever an error happens in the process with this listen stance,<br />
the listen will trigger.</p>
<p>&#8220;listen :to =&gt; :errors&#8221; only works with errors in the same process instance<br />
(same wfid).</p>
<p>&#8220;listen :to =&gt; :errors&#8221; doesn&#8217;t trigger when the error is caught (via<br />
:on_error).</p>
<h4>listen :to =&gt; :errors, :class =&gt; &#8216;ArgumentError&#8217;</h4>
<p>One can restrict the listen to certain classes of errors.<br />
Passing a list of error classes separated by a comma is OK.</p>
<h4>listen :to =&gt; :errors, :message =&gt; /x/</h4>
<p>One can restrict the error listening to errors matching a certain regex<br />
or equal to a certain string. The attribute is :message or :msg. The<br />
value is a String (strict equality) or a Regex (matching).</p>
</div>
</div>
</div>
</div>
<div id='footer'>
<div id='footer-center'>
<p>
<span id='footer-left'>
<a href='https://github.com/jmettraux/ruote_website/issues'>doc issue reporting</a>
|
<a href='https://github.com/jmettraux/ruote_website'>doc source</a>
| created with
<a href='http://nanoc.stoneship.org'>nanoc</a>
and
<a href='http://alexgorbatchev.com/SyntaxHighlighter/'>syntax highlighter</a>
</span>
<span id='footer-right'>
&copy; 2005-2013 the ruote team
</span>
</p>
</div>
</div>
<script>
  SyntaxHighlighter.all();
</script>
</body>
</html>
