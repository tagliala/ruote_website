<!DOCTYPE html>
<html><head>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<title>ruote - a sample workflow run</title>
<script src='/ruote_website/js/shCore.js'></script>
<script src='/ruote_website/js/shBrushXml.js'></script>
<script src='/ruote_website/js/shBrushBash.js'></script>
<script src='/ruote_website/js/shBrushRuby.js'></script>
<script src='/ruote_website/js/shBrushJScript.js'></script>
<!-- %script{ :src => "/js/jquery-1.6.1.min.js" } -->
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js'></script>
<link href='/ruote_website/css/reset.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shCore.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shThemeRuote.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/ruote.css' rel='stylesheet' type='text/css'>
</head><body>
<div id='container'>
<div id='header'>
<div id='header-center'>
<div id='header-left'>
<a href='/ruote_website'>
<img src='/ruote_website/images/ruote.png'>
</a>
<div id='header-subtitle'>
a ruby workflow engine
</div>
</div>
<div id='header-right'>
<div id='nav'>
<span>
<a href='/ruote_website/documentation.html' title='documentation'>
doc
</a>
<a href='/ruote_website/source.html' title='source code'>
source
</a>
<a href='/ruote_website/download.html' title='download'>
download
</a>
<a class='nihongo' href='/ja.html' title='日本語'>
日本語
</a>
</span>
</div>
</div>
</div>
</div>
<div id='content'>
<div id='content-center'>
<div id='sidebar'><h3 onclick='document.location = &quot;/ruote_website/documentation.html&quot;' style='cursor: pointer'>
Documentation
</h3>
<ul>
<li>
<a href='/ruote_website/common_attributes.html'>
common attributes
</a>
</li>
<li>
<a href='/ruote_website/conditions.html'>
conditions
</a>
</li>
<li>
<a href='/ruote_website/configuration.html'>
configuration
</a>
</li>
<li>
<a href='/ruote_website/documentation.html'>
documentation
</a>
</li>
<li>
<a href='/ruote_website/dollar.html'>
dollar notation
</a>
</li>
<li>
<a href='/ruote_website/download.html'>
download
</a>
</li>
<li>
<a href='/ruote_website/expressions.html'>
expressions
</a>
</li>
<li>
<a href='/ruote_website/glossary.html'>
glossary
</a>
</li>
<li>
<a href='/ruote_website/implementing_a_storage.html'>
implementing a storage
</a>
</li>
<li>
<a href='/ruote_website/implementing_participants.html'>
implementing participants
</a>
</li>
<li>
<a href='/ruote_website/lists.html'>
lists
</a>
</li>
<li>
<a href='/ruote_website/noisy.html'>
noisy output
</a>
</li>
<li>
<a href='/ruote_website/part_implementations.html'>
participant implementations
</a>
</li>
<li>
<a href='/ruote_website/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/ruote_website/process_administration.html'>
process administration
</a>
</li>
<li>
<a href='/ruote_website/definitions.html'>
process definitions
</a>
</li>
<li>
<a href='/ruote_website/process_observation.html'>
process observation
</a>
</li>
<li>
<a href='/ruote_website/participants.html'>
process participants
</a>
</li>
<li>
<a href='/ruote_website/rel.html'>
rel values for ruote-http / ruote-kit links
</a>
</li>
<li>
<a href='/ruote_website/resources.html'>
resources
</a>
</li>
<li>
<a href='/ruote_website/users.html'>
ruote users
</a>
</li>
<li class='current'>
<a href='/ruote_website/sample_workflow_run.html'>
sample workflow run
</a>
</li>
<li>
<a href='/ruote_website/source.html'>
source
</a>
</li>
<li>
<a href='/ruote_website/testing_participants.html'>
testing participants
</a>
</li>
<li>
<a href='/ruote_website/testing_processes.html'>
testing processes
</a>
</li>
<li>
<a href='/ruote_website/vars_and_fields.html'>
variables and fields
</a>
</li>
<li>
<a href='/ruote_website/with_rails.html'>
with rails
</a>
</li>
<li>
<a href='/ruote_website/patterns.html'>
workflow control patterns
</a>
</li>
<li>
<a href='/ruote_website/ja.html'>
日本語
</a>
</li>
</ul>
<h3>
More
</h3>
<ul class='contact'>
<li>
<a href='https://github.com/jmettraux/ruote/tree/master/quickstart'>
quickstart
</a>
</li>
<li>
<a href='/ruote_website/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/ruote_website/resources.html'>
resources
</a>
</li>
<li>
<a href='/ruote_website/users.html'>
users
</a>
</li>
</ul>
<h3>
Meta
</h3>
<ul class='contact'>
<li>
<a href='/ruote_website/source.html'>
source
</a>
</li>
<li>
<a href='/ruote_website/download.html'>
download
</a>
</li>
<li>
<a href='http://jmettraux.github.com'>
blog
</a>
</li>
<li>
<a href='/ruote_website/lists.html'>
mailing list
</a>
</li>
<li>
<a href='http://ruote-ci.s3.amazonaws.com/ci.html'>
continuous integration
</a>
</li>
<li>
<a href='http://ruote-irclogs.s3.amazonaws.com/logs.html'>
IRC
</a>
</li>
<li>
<a href='https://www.ohloh.net/p/ruote/'>
on ohloh
</a>
</li>
</ul>
<h3>
<span>
Search
</span>
</h3>
<ul class='contact'>
<li>
<form action='http://www.google.com/search' method='GET'>
<input id='qq' name='qq' style='' type='text'>
<input id='q' name='q' type='hidden'>
<input onclick='adjustSearch();' type='submit' value='search'>
</form>
</li>
</ul>
<script>
  function adjustSearch() {
    $('#q').val($('#qq').val() + ' site:http://ruote.rubyforge.org');
  }
</script>
</div>
<div id='content-main'>
<h2>a sample workflow run</h2>
<p>This page shows what happens with ruote when this simple workflow is run:</p>
<pre class="brush: ruby">
Ruote.define do
  alpha
  bravo
end
</pre>
<h3>a program to run our sample</h3>
<p>We need a small program with noisy set to true to show what&#8217;s happening.</p>
<pre class="brush: ruby">
require 'rubygems'
require 'ruote'

engine = Ruote::Engine.new(Ruote::Worker.new(Ruote::HashStorage.new))

pdef = Ruote.define do
  alpha
  bravo
end

engine.register do
  catchall Ruote::NoOpParticipant
end

engine.noisy = true

wfid = engine.launch(pdef)
engine.wait_for(wfid)
</pre>
<p>Look at the line where the engine gets instantiated:</p>
<pre class="brush: ruby">
engine = Ruote::Engine.new(Ruote::Worker.new(Ruote::HashStorage.new))
</pre>
<p>There are in fact three objects (at least) getting instantiated: the engine, a worker and the storage.</p>
<p>The &#8216;engine&#8217; should be renamed &#8216;dashboard&#8217;, it&#8217;s merely a bunch of methods for launching workflows and querying them.</p>
<p>The worker performs each atomic action that take the workflow from its start to its end.</p>
<p>The storage is where the workflows are persisted. It&#8217;s also where the message (that trigger the actions taken by workers) and the schedules (also triggering worker actions) are stored.</p>
<h3>from the point of view of the worker</h3>
<p>What does the worker do when we run our workflow ?</p>
<p>Since we have turned &#8220;noisy&#8221; on, it spits a few yellow lines to the stdout</p>
<p><a href="/images/sample_run_0.png"><img src="/images/sample_run_0.png" width="664px" /></a></p>
<p>That&#8217;s lot of data, fortunately, it can be stripped down to</p>
<pre class="brush: ruby">
launch * 20110722-bupugeki [
  "define", {}, [["alpha", {}, []], ["bravo", {}, []]]
]
  apply * 20110722-bupugeki 0_0 ["participant", {"ref"=&gt;"alpha"}, []]
  dispatch * alpha 20110722-bupugeki 0_0 Ruote::NoOpParticipant
  receive * alpha 20110722-bupugeki 0_0
  dispatched * 20110722-bupugeki 0_0
reply * 20110722-bupugeki 0
  apply * 20110722-bupugeki 0_1 ["participant", {"ref"=&gt;"bravo"}, []]
  dispatch * bravo 20110722-bupugeki 0_1 Ruote::NoOpParticipant
  receive * bravo 20110722-bupugeki 0_1
  dispatched * 20110722-bupugeki 0_1
reply * 20110722-bupugeki 0
terminate * 20110722-bupugeki 0
</pre>
<p>Each of those launch/apply/dispatch/reply/terminate line stand for 1 message handled by the worker.</p>
<p>When the message label is a verb (in the present) it indicates an action (taken by the worker), when the label is a past participle, it simply was a notification.</p>
<p>The funny &#8220;20110722-bupugeki&#8221; is the &#8220;wfid&#8221; (workflow instance id), the identifier (unique to the storage) for the process/workflow instance.</p>
<h3>from the point of view of the storage</h3>
<p>We have a noisy worker. Now what if the storage was emitting a line each time it stores or unstores something ?</p>
<pre class="brush: ruby">
       + msgs.put 523357!002 0
       - msgs.del 522662!001
       + expressions.put 0!!20110722-bejunoshite 0
       + expressions.put 0!!20110722-bejunoshite 1
       + msgs.put 526162!003 0
#launch * 20110722-bupugeki [
#  "define", {}, [["alpha", {}, []], ["bravo", {}, []]]
#]
       - msgs.del 523357!002
       - msgs.del 526162!003
       + expressions.put 0_0!!20110722-bejunoshite 0
       + expressions.put 0_0!!20110722-bejunoshite 1
       + msgs.put 530126!004 0
#  apply * 20110722-bupugeki 0_0 ["participant", {"ref"=&gt;"alpha"}, []]
       - msgs.del 530126!004
       + msgs.put 531783!005 0
#  dispatch * alpha 20110722-bupugeki 0_0 Ruote::NoOpParticipant
       + msgs.put 532535!006 0
       - msgs.del 531783!005
       - expressions.del 0_0!!20110722-bejunoshite
       + msgs.put 535061!007 0
#  receive * alpha 20110722-bupugeki 0_0
       - msgs.del 532535!006
#  dispatched * 20110722-bupugeki 0_0
       - msgs.del 535061!007
       + expressions.put 0!!20110722-bejunoshite 2
       + msgs.put 634234!008 0
#reply * 20110722-bupugeki 0
       - msgs.del 634234!008
       + expressions.put 0_1!!20110722-bejunoshite 0
       + expressions.put 0_1!!20110722-bejunoshite 1
       + msgs.put 636538!009 0
#  apply * 20110722-bupugeki 0_1 ["participant", {"ref"=&gt;"bravo"}, []]
       - msgs.del 636538!009
       + msgs.put 637318!010 0
#  dispatch * bravo 20110722-bupugeki 0_1 Ruote::NoOpParticipant
       + msgs.put 637577!011 0
       - msgs.del 637318!010
       - expressions.del 0_1!!20110722-bejunoshite
       + msgs.put 638697!012 0
#  receive * bravo 20110722-bupugeki 0_1
       - msgs.del 637577!011
#  dispatched * 20110722-bupugeki 0_1
       - msgs.del 638697!012
       - expressions.del 0!!20110722-bejunoshite
       + msgs.put 741979!013 0
#reply * 20110722-bupugeki 0
       - msgs.del 741979!013
#terminate * 20110722-bupugeki 0
</pre>
<p>It gets crowded. What if we removed the storage lines about &#8220;msgs&#8221;, they are the worker food, they already appear as wokrker actions. Let&#8217;s remove them.</p>
<pre class="brush: ruby">
       + expressions.put 0!!20110722-bejunoshite 0
       + expressions.put 0!!20110722-bejunoshite 1
#launch * 20110722-bupugeki [
#  "define", {}, [["alpha", {}, []], ["bravo", {}, []]]
#]
       + expressions.put 0_0!!20110722-bejunoshite 0
       + expressions.put 0_0!!20110722-bejunoshite 1
#  apply * 20110722-bupugeki 0_0 ["participant", {"ref"=&gt;"alpha"}, []]
#  dispatch * alpha 20110722-bupugeki 0_0 Ruote::NoOpParticipant
       - expressions.del 0_0!!20110722-bejunoshite
#  receive * alpha 20110722-bupugeki 0_0
#  dispatched * 20110722-bupugeki 0_0
       + expressions.put 0!!20110722-bejunoshite 2
#reply * 20110722-bupugeki 0
       + expressions.put 0_1!!20110722-bejunoshite 0
       + expressions.put 0_1!!20110722-bejunoshite 1
#  apply * 20110722-bupugeki 0_1 ["participant", {"ref"=&gt;"bravo"}, []]
#  dispatch * bravo 20110722-bupugeki 0_1 Ruote::NoOpParticipant
       - expressions.del 0_1!!20110722-bejunoshite
#  receive * bravo 20110722-bupugeki 0_1
#  dispatched * 20110722-bupugeki 0_1
       - expressions.del 0!!20110722-bejunoshite
#reply * 20110722-bupugeki 0
#terminate * 20110722-bupugeki 0
</pre>
<p>As the workflow unfolds, the worker is busy storing up-to-date versions of the expressions.</p>
<p>If we simplify a step further:</p>
<pre class="brush: ruby">
+ expressions.put 0!!20110722-bejunoshite

+ expressions.put 0_0!!20110722-bejunoshite
- expressions.del 0_0!!20110722-bejunoshite

+ expressions.put 0!!20110722-bejunoshite

+ expressions.put 0_1!!20110722-bejunoshite
- expressions.del 0_1!!20110722-bejunoshite

- expressions.del 0!!20110722-bejunoshite
</pre>
<p>The life of the workflow seen from the storage emerges, in the beginning, the expression 0 pops up, followed by the 0_0 one (alpha), which immediately dies, 0 gets updated, 0_1 (bravo) appears and dies immediately. 0 dies and since its the root of the workflow, the workflow di&#8230; terminates.</p>
</div>
</div>
</div>
</div>
<div id='footer'>
<div id='footer-center'>
<p>
<span id='footer-left'>
<a href='https://github.com/jmettraux/ruote_website/issues'>doc issue reporting</a>
|
<a href='https://github.com/jmettraux/ruote_website'>doc source</a>
| created with
<a href='http://nanoc.stoneship.org'>nanoc</a>
and
<a href='http://alexgorbatchev.com/SyntaxHighlighter/'>syntax highlighter</a>
</span>
<span id='footer-right'>
&copy; 2005-2013 the ruote team
</span>
</p>
</div>
</div>
<script>
  SyntaxHighlighter.all();
</script>
</body>
</html>
