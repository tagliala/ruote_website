<!DOCTYPE html>
<html><head>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<title>ruote - testing processes</title>
<script src='/ruote_website/js/shCore.js'></script>
<script src='/ruote_website/js/shBrushXml.js'></script>
<script src='/ruote_website/js/shBrushBash.js'></script>
<script src='/ruote_website/js/shBrushRuby.js'></script>
<script src='/ruote_website/js/shBrushJScript.js'></script>
<!-- %script{ :src => "/js/jquery-1.6.1.min.js" } -->
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js'></script>
<link href='/ruote_website/css/reset.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shCore.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/shThemeRuote.css' rel='stylesheet' type='text/css'>
<link href='/ruote_website/css/ruote.css' rel='stylesheet' type='text/css'>
</head><body>
<div id='container'>
<div id='header'>
<div id='header-center'>
<div id='header-left'>
<a href='/ruote_website'>
<img src='/ruote_website/images/ruote.png'>
</a>
<div id='header-subtitle'>
a ruby workflow engine
</div>
</div>
<div id='header-right'>
<div id='nav'>
<span>
<a href='/ruote_website/documentation.html' title='documentation'>
doc
</a>
<a href='/ruote_website/source.html' title='source code'>
source
</a>
<a href='/ruote_website/download.html' title='download'>
download
</a>
<a class='nihongo' href='/ja.html' title='日本語'>
日本語
</a>
</span>
</div>
</div>
</div>
</div>
<div id='content'>
<div id='content-center'>
<div id='sidebar'><h3 onclick='document.location = &quot;/ruote_website/documentation.html&quot;' style='cursor: pointer'>
Documentation
</h3>
<ul>
<li>
<a href='/ruote_website/common_attributes.html'>
common attributes
</a>
</li>
<li>
<a href='/ruote_website/conditions.html'>
conditions
</a>
</li>
<li>
<a href='/ruote_website/configuration.html'>
configuration
</a>
</li>
<li>
<a href='/ruote_website/documentation.html'>
documentation
</a>
</li>
<li>
<a href='/ruote_website/dollar.html'>
dollar notation
</a>
</li>
<li>
<a href='/ruote_website/download.html'>
download
</a>
</li>
<li>
<a href='/ruote_website/expressions.html'>
expressions
</a>
</li>
<li>
<a href='/ruote_website/glossary.html'>
glossary
</a>
</li>
<li>
<a href='/ruote_website/implementing_a_storage.html'>
implementing a storage
</a>
</li>
<li>
<a href='/ruote_website/implementing_participants.html'>
implementing participants
</a>
</li>
<li>
<a href='/ruote_website/lists.html'>
lists
</a>
</li>
<li>
<a href='/ruote_website/noisy.html'>
noisy output
</a>
</li>
<li>
<a href='/ruote_website/part_implementations.html'>
participant implementations
</a>
</li>
<li>
<a href='/ruote_website/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/ruote_website/process_administration.html'>
process administration
</a>
</li>
<li>
<a href='/ruote_website/definitions.html'>
process definitions
</a>
</li>
<li>
<a href='/ruote_website/process_observation.html'>
process observation
</a>
</li>
<li>
<a href='/ruote_website/participants.html'>
process participants
</a>
</li>
<li>
<a href='/ruote_website/rel.html'>
rel values for ruote-http / ruote-kit links
</a>
</li>
<li>
<a href='/ruote_website/resources.html'>
resources
</a>
</li>
<li>
<a href='/ruote_website/users.html'>
ruote users
</a>
</li>
<li>
<a href='/ruote_website/sample_workflow_run.html'>
sample workflow run
</a>
</li>
<li>
<a href='/ruote_website/source.html'>
source
</a>
</li>
<li>
<a href='/ruote_website/testing_participants.html'>
testing participants
</a>
</li>
<li class='current'>
<a href='/ruote_website/testing_processes.html'>
testing processes
</a>
</li>
<li>
<a href='/ruote_website/vars_and_fields.html'>
variables and fields
</a>
</li>
<li>
<a href='/ruote_website/with_rails.html'>
with rails
</a>
</li>
<li>
<a href='/ruote_website/patterns.html'>
workflow control patterns
</a>
</li>
<li>
<a href='/ruote_website/ja.html'>
日本語
</a>
</li>
</ul>
<h3>
More
</h3>
<ul class='contact'>
<li>
<a href='https://github.com/jmettraux/ruote/tree/master/quickstart'>
quickstart
</a>
</li>
<li>
<a href='/ruote_website/presentations.html'>
presentations
</a>
</li>
<li>
<a href='/ruote_website/resources.html'>
resources
</a>
</li>
<li>
<a href='/ruote_website/users.html'>
users
</a>
</li>
</ul>
<h3>
Meta
</h3>
<ul class='contact'>
<li>
<a href='/ruote_website/source.html'>
source
</a>
</li>
<li>
<a href='/ruote_website/download.html'>
download
</a>
</li>
<li>
<a href='http://jmettraux.github.com'>
blog
</a>
</li>
<li>
<a href='/ruote_website/lists.html'>
mailing list
</a>
</li>
<li>
<a href='http://ruote-ci.s3.amazonaws.com/ci.html'>
continuous integration
</a>
</li>
<li>
<a href='http://ruote-irclogs.s3.amazonaws.com/logs.html'>
IRC
</a>
</li>
<li>
<a href='https://www.ohloh.net/p/ruote/'>
on ohloh
</a>
</li>
</ul>
<h3>
<span>
Search
</span>
</h3>
<ul class='contact'>
<li>
<form action='http://www.google.com/search' method='GET'>
<input id='qq' name='qq' style='' type='text'>
<input id='q' name='q' type='hidden'>
<input onclick='adjustSearch();' type='submit' value='search'>
</form>
</li>
</ul>
<script>
  function adjustSearch() {
    $('#q').val($('#qq').val() + ' site:http://ruote.rubyforge.org');
  }
</script>
</div>
<div id='content-main'>
<h2>testing processes</h2>
<p>A few notes about testing/specing process definitions</p>
<p>The dir:&#8220;https://github.com/jmettraux/ruote/tree/master/test/functional&#8221; is full of process definitions tortured by tests, but each of them is very technical.</p>
<h3>#wait_for(x)</h3>
<p>This dashboard (engine) method is heavily used to make the test thread wait for the engine (worker) thread.</p>
<p>It&#8217;s documented <a href="http://ruote.rubyforge.org/rdoc/Ruote/Dashboard.html#method-i-wait_for">there</a></p>
<p>Note: wait_for is not meant to be used outside tests, unless in some special cases.</p>
<h3>the bare way</h3>
<p>Testing a process definition without a test framework. Useful when demonstrating a ruote feature or making sure that this feature works for a person (I use this way all the time on the mailing list).</p>
<pre class="brush: ruby">
require 'rubygems'
require 'ruote' # gem install ruote

engine = Ruote::Engine.new(Ruote::Worker.new(Ruote::HashStorage.new()))
  # an engine + worker combo with an in-memory storage,
  # ideal for process definition testing

#engine.noisy = true
  # when the engine/worker is not replying, uncomment this and restart the
  # test, it the worker will then explain its activity in yellow chars
  # in your console

engine.register do
  catchall
end

pdef = Ruote.process_definition do
  alpha
  bravo
end

wfid = engine.launch(pdef, { 'colour' =&gt; 'blue' })
  # launching an instance of pdef, with a workitem whose initial fields
  # contain 'colour' =&gt; 'blue'
  #
  # we keep the process instance id in the variable 'wfid' (workflow
  # instance id)

engine.wait_for(:alpha)
  # waiting for a participant name as a symbol, this call will block until
  # a workitem was delivered to participant 'alpha'

workitem = engine.storage_participant.first
  # grab the workitem from the storage participant

#workitem.fields['colour'] = 'red'
  # maybe alter the payload of the workitem

engine.storage_participant.reply(workitem)
  # hands back the workitem to the storage participant, it will erase it
  # and hand it back to the engine so that the flow may resume

engine.wait_for(:bravo)
  # waiting for flow to pop a workitem up at the next step

workitem = engine.storage_participant.first
  # grab the workitem from the storage participant

engine.storage_participant.reply(workitem)

engine.wait_for(wfid)
  # wait for our process to terminate (or to issue an error)

raise "process not over" if engine.process(wfid)
</pre>
<h3>test/unit way</h3>
<p><span class="caps">TODO</span></p>
<h3>rspec way</h3>
<p>An example spec, it instantiates a new dashboard with a worker and an in-memory storage each time. The participant is a simple catchall, that bombs if the workitem field &#8216;fail&#8217; is true-ish.</p>
<pre class="brush: ruby">
require 'ruote'


describe 'my freaking process' do

  before 'each' do

    @board = Ruote::Dashboard.new(Ruote::Worker.new(Ruote::HashStorage.new))

    @board.register '.+' do |workitem|
      pname = workitem.participant_name
      fail 'doom' if pname != 'charly' &amp;&amp; workitem.fields['fail']
      workitem.fields[workitem.participant_name] = 'was here'
    end
  end

  after 'each' do

    @board.shutdown
  end

  let(:definition) do
    Ruote.define :on_error =&gt; 'charly' do
      alpha
      bravo
    end
  end

  # the specs...

  context 'happy path' do

    it 'completes successfully' do

      wfid = @board.launch(definition)

      r = @board.wait_for(wfid)
        # wait until process terminates or hits an error

      r['workitem'].should_not == nil
      r['workitem']['fields']['alpha'].should == 'was here'
      r['workitem']['fields']['bravo'].should == 'was here'
      r['workitem']['fields']['charly'].should == nil
    end
  end

  context 'unhappy path' do

    it 'routes to charly' do

      initial_workitem_fields = { 'fail' =&gt; true }

      wfid = @board.launch(definition, initial_workitem_fields)

      r = @board.wait_for(wfid)
        # wait until process terminates or hits an error

      r['workitem'].should_not == nil
      r['workitem']['fields']['alpha'].should == nil
      r['workitem']['fields']['bravo'].should == nil
      r['workitem']['fields']['charly'].should == 'was here'
    end
  end
end
</pre>
<h3>cucumber way</h3>
<p><a href="http://github.com/jmettraux/ruote-cukes">ruote-cukes</a> is a set of step definitions for testing ruote process definitions from <a href="http://cukes.info/">Cucumber</a>, unfortunately, it&#8217;s not complete.</p>
</div>
</div>
</div>
</div>
<div id='footer'>
<div id='footer-center'>
<p>
<span id='footer-left'>
<a href='https://github.com/jmettraux/ruote_website/issues'>doc issue reporting</a>
|
<a href='https://github.com/jmettraux/ruote_website'>doc source</a>
| created with
<a href='http://nanoc.stoneship.org'>nanoc</a>
and
<a href='http://alexgorbatchev.com/SyntaxHighlighter/'>syntax highlighter</a>
</span>
<span id='footer-right'>
&copy; 2005-2013 the ruote team
</span>
</p>
</div>
</div>
<script>
  SyntaxHighlighter.all();
</script>
</body>
</html>
